function ShoppingCart(){this.cartList=document.querySelector(".cart-list-container"),this.cartCount=document.getElementById("cart-count"),this.dummyProduct=document.getElementById("dummy"),this.btnShoppingCartContainer=document.getElementById("shopping-cart-menu"),this.currentPromoCode,this.addItem=function(t){var e,r=this.getProductInCart(t.id);r?(e=r.querySelector(".product__quantity > input").value,r.querySelector(".product__quantity > input").value=parseInt(e)+1):this.cartList.appendChild(this._cloneDummy(t));var i=document.querySelector(".btn-cart-container > label");$D(i).callbackAnim("shake",300),this.updateDom()},this._cloneDummy=function(t){var e=this.dummyProduct.cloneNode(!0),r=this;return e.removeAttribute("style"),e.removeAttribute("id"),e.setAttribute("data-product-id",t.id),e.querySelector(".product__title").innerHTML=t.name,e.querySelector(".product__description").innerHTML=t.description,e.querySelector(".product__price").innerHTML=t.price,e.querySelector(".product__image").style.backgroundImage=t.imgUrl,e.querySelector(".product__remove").addEventListener("click",function(t){t.preventDefault(),$D(this.parentNode).callbackAnim("exclude",900,function(){this.el.remove(),r.updateDom()})}),e.querySelector(".product__quantity > input").addEventListener("input",function(t){0===parseInt(this.value)?$D(this.parentNode.parentNode).callbackAnim("exclude",900,function(){this.el.remove(),r._updatePromoCodeDom(document.getElementById("promoCode")),r.updateDom()}):(r._updatePromoCodeDom(document.getElementById("promoCode")),r.updateDom())}),e},this.getProductInCart=function(t){return this.cartList.querySelector('[data-product-id="'+t+'"]')},this.getProductPrice=function(t){return parseFloat(t.querySelector(".product__price").innerHTML.replace("$",""))},this.removeItem=function(t){this.parent.remove(),this.updateDom()},this.countItems=function(){var t=0;return document.querySelectorAll(".cart-list-container article.product:not(#dummy)").forEach(function(e){t+=parseInt(e.querySelector(".product__quantity > input").value)}),t},this.getPromoFunc=function(t){var e=[],r=this;return e.ROLF10=function(t){var e=r.getProductPrice(t);return 9===parseInt(t.getAttribute("data-product-id"))?(e-=.1*e,r.__updateItemDiscountDom(e,t,!0)):r.__updateItemDiscountDom(e,t,!1),e},e.BLACK15=function(t){var e=r.getProductPrice(t);return[11,4,1].indexOf(parseInt(t.getAttribute("data-product-id")))>=0?(e-=.15*e,r.__updateItemDiscountDom(e,t,!0)):r.__updateItemDiscountDom(e,t,!1),e},e.ALL5=function(t){var e=r.getProductPrice(t);return e-=.05*e,r.__updateItemDiscountDom(e,t,!0),e},e.indexOf(t)>=0&&e[t],e[t]},this.updateDom=function(){var t=this.countItems();this._updateCartButton(t),this._updateCartPrice()},this.__updateItemDiscountDom=function(t,e,r){var i=e.querySelector(".product__price"),o=e.querySelector(".product__discount");r?(i.className+=" discount ",o.innerHTML=t.toFixed(2)+"$"):(i.className=i.className.replace(/ discount /g,""),o.innerHTML="")},this._updateCartPrice=function(){this.cartList.querySelector(".total-price").innerHTML=this.calcTotalPrice(this.currentPromoCode)+"$"},this._updateCartButton=function(t){t>0&&!$D(this.btnShoppingCartContainer).hasClass("active")?$D(this.btnShoppingCartContainer).addClass("active"):0===t&&$D(this.btnShoppingCartContainer).removeClass("active"),this.cartCount.innerHTML="("+t+")"},this._updatePromoCodeDom=function(t){this.applyPromoCode(t.value),t.value.toUpperCase()===this.currentPromoCode?$D(t).addClass("active"):$D(t).removeClass("active")},this.applyPromoCode=function(t){t=t.toUpperCase();var e=this.currentPromoCode?this.calcTotalPrice(this.currentPromoCode):this.calcTotalPrice();this.calcTotalPrice(t)<e&&(this.currentPromoCode=t),this.updateDom()},this.calcTotalPrice=function(t){var e,r=0,i=this;return t&&(e=this.getPromoFunc(t)),this._getCartItems().forEach(function(t){var o=parseInt(t.querySelector(".product__quantity > input").value),n=i.getProductPrice(t);void 0!==e&&(n=e(t)),r+=o*n}),r.toFixed(2)},this._getCartItems=function(){return document.querySelectorAll(".cart-list-container article.product:not(#dummy)")},this.init=function(){return this._registerAddToCartEvent(),this._registerPromoCodeEvent(),this},this._registerAddToCartEvent=function(){document.querySelectorAll(".product-list > .product").forEach(function(t){var e={id:t.getAttribute("data-product-id"),name:t.querySelector(".product__title").innerHTML,description:t.querySelector(".product__description").innerHTML,price:t.querySelector(".product__price").innerHTML,imgUrl:t.querySelector(".product__image").style.backgroundImage};t.addEventListener("click",function(t){t.preventDefault(),cart.addItem(e)})})},this._registerPromoCodeEvent=function(){var t=this;document.getElementById("promoCode").addEventListener("input",function(){t._updatePromoCodeDom(this)})}}function DomUtils(t){return this.el=t,this.getEl=function(){return this.el},this.hasClass=function(t){return this.el.className.indexOf(t)>-1},this.addClass=function(t){return this.hasClass(" "+t+" ")?this:(this.el.className+=" "+t+" ",this)},this.removeClass=function(t){if(!this.hasClass(t))return this;var e,r="",i=this.el.className.split(" ").filter(function(t){return t});for(e=0;e<i.length;e++)i[e]!==t&&(r+=i[e]+" ");return this.el.className=r,this},this.callbackAnim=function(t,e,r){this.addClass(t);var i=this;setTimeout(function(){i.removeClass(t),r&&r.bind(i)()},e)},this}$D=function(t){return new DomUtils(t)};var cart=(new ShoppingCart).init();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImphdmFzY3JpcHQuanMiXSwibmFtZXMiOlsiU2hvcHBpbmdDYXJ0IiwidGhpcyIsImNhcnRMaXN0IiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiY2FydENvdW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJkdW1teVByb2R1Y3QiLCJidG5TaG9wcGluZ0NhcnRDb250YWluZXIiLCJjdXJyZW50UHJvbW9Db2RlIiwiYWRkSXRlbSIsInByb2R1Y3REYXRhIiwicXRkIiwicHJvZHVjdEluQ2FydCIsImdldFByb2R1Y3RJbkNhcnQiLCJpZCIsInZhbHVlIiwicGFyc2VJbnQiLCJhcHBlbmRDaGlsZCIsIl9jbG9uZUR1bW15IiwiYnRuQ2FydCIsIiREIiwiY2FsbGJhY2tBbmltIiwidXBkYXRlRG9tIiwicHJvZHVjdCIsImNsb25lTm9kZSIsInNlbGYiLCJyZW1vdmVBdHRyaWJ1dGUiLCJzZXRBdHRyaWJ1dGUiLCJpbm5lckhUTUwiLCJuYW1lIiwiZGVzY3JpcHRpb24iLCJwcmljZSIsInN0eWxlIiwiYmFja2dyb3VuZEltYWdlIiwiaW1nVXJsIiwiYWRkRXZlbnRMaXN0ZW5lciIsImUiLCJwcmV2ZW50RGVmYXVsdCIsInBhcmVudE5vZGUiLCJlbCIsInJlbW92ZSIsIl91cGRhdGVQcm9tb0NvZGVEb20iLCJwcm9kdWN0SWQiLCJnZXRQcm9kdWN0UHJpY2UiLCJpdGVtIiwicGFyc2VGbG9hdCIsInJlcGxhY2UiLCJyZW1vdmVJdGVtIiwicGFyZW50IiwiY291bnRJdGVtcyIsIml0ZW5zQ291bnQiLCJxdWVyeVNlbGVjdG9yQWxsIiwiZm9yRWFjaCIsImdldFByb21vRnVuYyIsInByb21vQ29kZSIsImNvZGVzIiwiZ2V0QXR0cmlidXRlIiwiX191cGRhdGVJdGVtRGlzY291bnREb20iLCJpbmRleE9mIiwiX3VwZGF0ZUNhcnRCdXR0b24iLCJfdXBkYXRlQ2FydFByaWNlIiwic2hvdyIsIml0ZW1QcmljZSIsIml0ZW1EaXNjb3VudCIsImNsYXNzTmFtZSIsInRvRml4ZWQiLCJjYWxjVG90YWxQcmljZSIsImhhc0NsYXNzIiwiYWRkQ2xhc3MiLCJyZW1vdmVDbGFzcyIsInByb21vSW5wdXQiLCJhcHBseVByb21vQ29kZSIsInRvVXBwZXJDYXNlIiwiY3VycmVudFZhbHVlIiwicHJvbW9GdW5jdGlvbiIsInRvdGFsIiwiX2dldENhcnRJdGVtcyIsInF1YW50aXR5IiwidW5kZWZpbmVkIiwiaW5pdCIsIl9yZWdpc3RlckFkZFRvQ2FydEV2ZW50IiwiX3JlZ2lzdGVyUHJvbW9Db2RlRXZlbnQiLCJjYXJ0IiwiRG9tVXRpbHMiLCJlbGVtZW50IiwiZ2V0RWwiLCJjbHMiLCJhZGQiLCJpIiwibmV3Q2xhc3NOYW1lIiwiY2xhc3NlcyIsInNwbGl0IiwiZmlsdGVyIiwiY2xzTmFtZSIsImxlbmd0aCIsImFuaW1DbGFzcyIsIm1pbGxpc2Vjb25kcyIsImNiRnVuYyIsInNldFRpbWVvdXQiLCJiaW5kIl0sIm1hcHBpbmdzIjoiQUFBQSxTQUFBQSxlQUNBQyxLQUFBQyxTQUFBQyxTQUFBQyxjQUFBLHdCQUNBSCxLQUFBSSxVQUFBRixTQUFBRyxlQUFBLGNBQ0FMLEtBQUFNLGFBQUFKLFNBQUFHLGVBQUEsU0FDQUwsS0FBQU8seUJBQUFMLFNBQUFHLGVBQUEsc0JBQ0FMLEtBQUFRLGlCQUVBUixLQUFBUyxRQUFBLFNBQUFDLEdBQ0EsSUFDQUMsRUFEQUMsRUFBQVosS0FBQWEsaUJBQUFILEVBQUFJLElBR0FGLEdBQ0FELEVBQUFDLEVBQUFULGNBQUEsOEJBQUFZLE1BQ0FILEVBQUFULGNBQUEsOEJBQUFZLE1BQUFDLFNBQUFMLEdBQUEsR0FHQVgsS0FBQUMsU0FBQWdCLFlBQUFqQixLQUFBa0IsWUFBQVIsSUFFQSxJQUFBUyxFQUFBakIsU0FBQUMsY0FBQSwrQkFFQWlCLEdBQUFELEdBQUFFLGFBQUEsUUFBQSxLQUVBckIsS0FBQXNCLGFBSUF0QixLQUFBa0IsWUFBQSxTQUFBUixHQUVBLElBQUFhLEVBQUF2QixLQUFBTSxhQUFBa0IsV0FBQSxHQUNBQyxFQUFBekIsS0FtQ0EsT0F4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RUEsSUFBQUwsRUFBQSxFQUFBQSxFQUFBRSxFQUFBSSxPQUFBTixJQUNBRSxFQUFBRixLQUFBaEQsSUFDQWlELEdBQUFDLEVBQUFGLEdBQUEsS0FNQSxPQUZBeEYsS0FBQXVDLEdBQUF5QixVQUFBeUIsRUFFQXpGLE1BR0FBLEtBQUFxQixhQUFBLFNBQUEwRSxFQUFBQyxFQUFBQyxHQUNBakcsS0FBQW9FLFNBQUEyQixHQUNBLElBQUF0RSxFQUFBekIsS0FTQWtHLFdBUkEsV0FDQXpFLEVBQUE0QyxZQUFBMEIsR0FFQUUsR0FDQUEsRUFBQUUsS0FBQTFFLEVBQUF3RSxJQUlBRCxJQUdBaEcsS0FHQW9CLEdBQUEsU0FBQWdFLEdBRUEsT0FEQSxJQUFBRCxTQUFBQyxJQUtBLElBQUFGLE1BQUEsSUFBQW5GLGNBQUFnRiIsImZpbGUiOiJzY3JpcHQubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiZnVuY3Rpb24gU2hvcHBpbmdDYXJ0KCkge1xyXG5cdHRoaXMuY2FydExpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY2FydC1saXN0LWNvbnRhaW5lcicpO1xyXG5cdHRoaXMuY2FydENvdW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhcnQtY291bnQnKTtcclxuXHR0aGlzLmR1bW15UHJvZHVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiZHVtbXlcIik7XHJcblx0dGhpcy5idG5TaG9wcGluZ0NhcnRDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInNob3BwaW5nLWNhcnQtbWVudVwiKTtcclxuXHR0aGlzLmN1cnJlbnRQcm9tb0NvZGU7XHJcblxyXG5cdHRoaXMuYWRkSXRlbSA9IGZ1bmN0aW9uKHByb2R1Y3REYXRhKSB7XHJcblx0XHR2YXIgcHJvZHVjdEluQ2FydCA9IHRoaXMuZ2V0UHJvZHVjdEluQ2FydChwcm9kdWN0RGF0YS5pZCk7XHJcblx0XHR2YXIgcXRkO1xyXG5cdFx0XHJcblx0XHRpZihwcm9kdWN0SW5DYXJ0KSB7XHJcblx0XHRcdHF0ZCA9IHByb2R1Y3RJbkNhcnQucXVlcnlTZWxlY3RvcignLnByb2R1Y3RfX3F1YW50aXR5ID4gaW5wdXQnKS52YWx1ZTtcclxuXHRcdFx0cHJvZHVjdEluQ2FydC5xdWVyeVNlbGVjdG9yKCcucHJvZHVjdF9fcXVhbnRpdHkgPiBpbnB1dCcpLnZhbHVlID0gcGFyc2VJbnQocXRkKSArIDE7IFxyXG5cdFx0fVxyXG5cdFx0ZWxzZSB7XHJcblx0XHRcdHRoaXMuY2FydExpc3QuYXBwZW5kQ2hpbGQodGhpcy5fY2xvbmVEdW1teShwcm9kdWN0RGF0YSkpO1x0XHJcblx0XHR9XHJcblx0XHR2YXIgYnRuQ2FydCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5idG4tY2FydC1jb250YWluZXIgPiBsYWJlbCcpO1xyXG5cclxuXHRcdCREKGJ0bkNhcnQpLmNhbGxiYWNrQW5pbShcInNoYWtlXCIsMzAwKTtcclxuXHJcblx0XHR0aGlzLnVwZGF0ZURvbSgpO1xyXG5cdFx0XHJcblx0fTtcclxuXHJcblx0dGhpcy5fY2xvbmVEdW1teSA9IGZ1bmN0aW9uKHByb2R1Y3REYXRhKSB7XHJcblxyXG5cdFx0dmFyIHByb2R1Y3QgPSB0aGlzLmR1bW15UHJvZHVjdC5jbG9uZU5vZGUodHJ1ZSk7XHJcblx0XHR2YXIgc2VsZiA9IHRoaXM7XHJcblxyXG5cdFx0dmFyIHJlbW92ZVByb2R1Y3QgPSBmdW5jdGlvbihlKSB7XHJcblx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcclxuXHRcdFx0JEQodGhpcy5wYXJlbnROb2RlKS5jYWxsYmFja0FuaW0oXCJleGNsdWRlXCIsOTAwLGZ1bmN0aW9uKCl7XHJcblx0XHRcdFx0dGhpcy5lbC5yZW1vdmUoKTtcclxuXHRcdFx0XHRzZWxmLnVwZGF0ZURvbSgpO1xyXG5cdFx0XHR9KTtcclxuXHRcdH07XHJcblxyXG5cclxuXHRcdHByb2R1Y3QucmVtb3ZlQXR0cmlidXRlKCdzdHlsZScpO1xyXG5cdFx0cHJvZHVjdC5yZW1vdmVBdHRyaWJ1dGUoJ2lkJyk7XHJcblx0XHRwcm9kdWN0LnNldEF0dHJpYnV0ZSgnZGF0YS1wcm9kdWN0LWlkJyxwcm9kdWN0RGF0YS5pZCk7XHJcblx0XHRwcm9kdWN0LnF1ZXJ5U2VsZWN0b3IoJy5wcm9kdWN0X190aXRsZScpLmlubmVySFRNTCA9IHByb2R1Y3REYXRhLm5hbWU7XHJcblx0XHRwcm9kdWN0LnF1ZXJ5U2VsZWN0b3IoJy5wcm9kdWN0X19kZXNjcmlwdGlvbicpLmlubmVySFRNTCA9IHByb2R1Y3REYXRhLmRlc2NyaXB0aW9uO1xyXG5cdFx0cHJvZHVjdC5xdWVyeVNlbGVjdG9yKCcucHJvZHVjdF9fcHJpY2UnKS5pbm5lckhUTUwgPSBwcm9kdWN0RGF0YS5wcmljZTtcclxuXHRcdHByb2R1Y3QucXVlcnlTZWxlY3RvcignLnByb2R1Y3RfX2ltYWdlJykuc3R5bGUuYmFja2dyb3VuZEltYWdlID0gcHJvZHVjdERhdGEuaW1nVXJsO1xyXG5cdFx0cHJvZHVjdC5xdWVyeVNlbGVjdG9yKCcucHJvZHVjdF9fcmVtb3ZlJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCByZW1vdmVQcm9kdWN0KTtcclxuXHJcblx0XHRwcm9kdWN0LnF1ZXJ5U2VsZWN0b3IoJy5wcm9kdWN0X19xdWFudGl0eSA+IGlucHV0JykuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsZnVuY3Rpb24oZSl7XHJcblx0XHRcdGlmKHBhcnNlSW50KHRoaXMudmFsdWUpID09PSAwKSB7XHJcblx0XHRcdFx0JEQodGhpcy5wYXJlbnROb2RlLnBhcmVudE5vZGUpLmNhbGxiYWNrQW5pbShcImV4Y2x1ZGVcIiw5MDAsZnVuY3Rpb24oKXtcclxuXHRcdFx0XHRcdHRoaXMuZWwucmVtb3ZlKCk7XHJcblx0XHRcdFx0XHRzZWxmLl91cGRhdGVQcm9tb0NvZGVEb20oZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJwcm9tb0NvZGVcIikpO1xyXG5cdFx0XHRcdFx0c2VsZi51cGRhdGVEb20oKTtcdFx0XHRcdFx0XHRcdFx0XHRcclxuXHRcdFx0XHR9KTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRzZWxmLl91cGRhdGVQcm9tb0NvZGVEb20oZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJwcm9tb0NvZGVcIikpO1xyXG5cdFx0XHRcdHNlbGYudXBkYXRlRG9tKCk7XHRcdFx0XHRcclxuXHRcdFx0fVxyXG5cclxuXHRcdH0pO1xyXG5cclxuXHRcdHJldHVybiBwcm9kdWN0O1xyXG5cclxuXHR9LFxyXG5cclxuXHJcblx0dGhpcy5nZXRQcm9kdWN0SW5DYXJ0ID0gZnVuY3Rpb24ocHJvZHVjdElkKSB7XHJcblx0XHRyZXR1cm4gdGhpcy5jYXJ0TGlzdC5xdWVyeVNlbGVjdG9yKCdbZGF0YS1wcm9kdWN0LWlkPVwiJytwcm9kdWN0SWQrJ1wiXScpO1xyXG5cdH0sXHJcblxyXG5cdHRoaXMuZ2V0UHJvZHVjdFByaWNlID0gZnVuY3Rpb24oaXRlbSkge1xyXG5cdFx0cmV0dXJuIHBhcnNlRmxvYXQoaXRlbS5xdWVyeVNlbGVjdG9yKCcucHJvZHVjdF9fcHJpY2UnKS5pbm5lckhUTUwucmVwbGFjZSgnJCcsJycpKTtcclxuXHR9O1xyXG5cclxuXHR0aGlzLnJlbW92ZUl0ZW0gPSBmdW5jdGlvbihwcm9kdWN0KSB7XHJcblx0XHR0aGlzLnBhcmVudC5yZW1vdmUoKTtcclxuXHRcdHRoaXMudXBkYXRlRG9tKCk7XHJcblx0fTtcclxuXHJcblx0dGhpcy5jb3VudEl0ZW1zID0gZnVuY3Rpb24oKSB7XHJcblx0XHR2YXIgaXRlbnNDb3VudCA9IDA7XHJcblx0XHRkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuY2FydC1saXN0LWNvbnRhaW5lciBhcnRpY2xlLnByb2R1Y3Q6bm90KCNkdW1teSknKS5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pe1xyXG5cdFx0XHRpdGVuc0NvdW50ICs9IHBhcnNlSW50KGl0ZW0ucXVlcnlTZWxlY3RvcignLnByb2R1Y3RfX3F1YW50aXR5ID4gaW5wdXQnKS52YWx1ZSk7XHJcblx0XHR9KTtcclxuXHJcblx0XHRyZXR1cm4gaXRlbnNDb3VudDtcclxuXHR9O1xyXG5cclxuXHJcblx0dGhpcy5nZXRQcm9tb0Z1bmMgPSBmdW5jdGlvbihwcm9tb0NvZGUpIHtcclxuXHRcdHZhciBmdW5jO1xyXG5cdFx0dmFyIGNvZGVzID0gW107XHJcblx0XHR2YXIgc2VsZiA9IHRoaXM7XHJcblxyXG5cdFx0Y29kZXNbJ1JPTEYxMCddID0gZnVuY3Rpb24oaXRlbSkge1xyXG5cdFx0XHQvL2lmIGl0cyBSb2xmLCBnaXZlcyAxMCUgZGlzY291bnQuXHJcblx0XHRcdHZhciBwcmljZSA9IHNlbGYuZ2V0UHJvZHVjdFByaWNlKGl0ZW0pO1xyXG5cclxuXHRcdFx0aWYocGFyc2VJbnQoaXRlbS5nZXRBdHRyaWJ1dGUoJ2RhdGEtcHJvZHVjdC1pZCcpKSA9PT0gOSkge1xyXG5cdFx0XHRcdHByaWNlID0gcHJpY2UgLSAocHJpY2UgKiAwLjEpO1xyXG5cdFx0XHRcdHNlbGYuX191cGRhdGVJdGVtRGlzY291bnREb20ocHJpY2UsaXRlbSx0cnVlKTtcdFx0XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0c2VsZi5fX3VwZGF0ZUl0ZW1EaXNjb3VudERvbShwcmljZSxpdGVtLGZhbHNlKTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0XHJcblx0XHRcdHJldHVybiBwcmljZTtcclxuXHRcdH07XHJcblx0XHRjb2Rlc1snQkxBQ0sxNSddID0gZnVuY3Rpb24oaXRlbSkge1xyXG5cdFx0XHQvL0FsbCBibGFjayBmdXIgZG9ncyB3aXRoIDE1JSBkaXNjb3VudC5cclxuXHRcdFx0dmFyIHByaWNlID0gc2VsZi5nZXRQcm9kdWN0UHJpY2UoaXRlbSk7XHJcblx0XHRcdC8vQXRsYXMsWmV1cyxTbm93XHJcblx0XHRcdGlmIChbMTEsNCwxXS5pbmRleE9mKHBhcnNlSW50KGl0ZW0uZ2V0QXR0cmlidXRlKCdkYXRhLXByb2R1Y3QtaWQnKSkpID49IDAgKSB7XHJcblx0XHRcdFx0cHJpY2UgPSBwcmljZSAtIChwcmljZSAqIDAuMTUpO1xyXG5cdFx0XHRcdHNlbGYuX191cGRhdGVJdGVtRGlzY291bnREb20ocHJpY2UsaXRlbSx0cnVlKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRzZWxmLl9fdXBkYXRlSXRlbURpc2NvdW50RG9tKHByaWNlLGl0ZW0sZmFsc2UpO1xyXG5cdFx0XHR9XHJcblx0XHRcdHJldHVybiBwcmljZTtcclxuXHRcdH07XHJcblxyXG5cdFx0Y29kZXNbJ0FMTDUnXSA9IGZ1bmN0aW9uKGl0ZW0pIHtcclxuXHRcdFx0Ly81JSBkaXNjb3VudCB0b3RhbCBvcmRlclxyXG5cdFx0XHR2YXIgcHJpY2UgPSBzZWxmLmdldFByb2R1Y3RQcmljZShpdGVtKTtcclxuXHJcblx0XHRcdHByaWNlID0gcHJpY2UgLSAocHJpY2UgKiAwLjA1KTtcclxuXHRcdFx0c2VsZi5fX3VwZGF0ZUl0ZW1EaXNjb3VudERvbShwcmljZSxpdGVtLHRydWUpO1xyXG5cclxuXHRcdFx0cmV0dXJuIHByaWNlO1xyXG5cdFx0fTtcclxuXHJcblx0XHRpZihjb2Rlcy5pbmRleE9mKHByb21vQ29kZSkgPj0gMCkgZnVuYyA9IGNvZGVzW3Byb21vQ29kZV07XHJcblxyXG5cdFx0cmV0dXJuIGNvZGVzW3Byb21vQ29kZV07XHJcblxyXG5cclxuXHR9O1xyXG5cclxuXHJcblx0dGhpcy51cGRhdGVEb20gPSBmdW5jdGlvbigpIHtcclxuXHRcdHZhciBjb3VudEl0ZW1zID0gdGhpcy5jb3VudEl0ZW1zKCk7XHJcblx0XHR0aGlzLl91cGRhdGVDYXJ0QnV0dG9uKGNvdW50SXRlbXMpO1xyXG5cdFx0dGhpcy5fdXBkYXRlQ2FydFByaWNlKCk7XHJcblx0fTtcclxuXHJcblx0dGhpcy5fX3VwZGF0ZUl0ZW1EaXNjb3VudERvbSA9IGZ1bmN0aW9uKHByaWNlLGl0ZW0sc2hvdykge1xyXG5cdFx0dmFyIGl0ZW1QcmljZSA9IGl0ZW0ucXVlcnlTZWxlY3RvcihcIi5wcm9kdWN0X19wcmljZVwiKTtcclxuXHRcdHZhciBpdGVtRGlzY291bnQgPSBpdGVtLnF1ZXJ5U2VsZWN0b3IoXCIucHJvZHVjdF9fZGlzY291bnRcIik7XHJcblxyXG5cdFx0aWYoc2hvdykge1xyXG5cdFx0XHRpdGVtUHJpY2UuY2xhc3NOYW1lICs9IFwiIGRpc2NvdW50IFwiO1xyXG5cdFx0XHRpdGVtRGlzY291bnQuaW5uZXJIVE1MID0gcHJpY2UudG9GaXhlZCgyKStcIiRcIjtcdFx0XHRcdFxyXG5cdFx0fVxyXG5cdFx0ZWxzZSB7XHJcblx0XHRcdGl0ZW1QcmljZS5jbGFzc05hbWUgPSBpdGVtUHJpY2UuY2xhc3NOYW1lLnJlcGxhY2UoLyBkaXNjb3VudCAvZywnJyk7XHJcblx0XHRcdGl0ZW1EaXNjb3VudC5pbm5lckhUTUwgPSBcIlwiO1x0XHJcblx0XHR9XHJcblxyXG5cdH07XHJcblxyXG5cclxuXHR0aGlzLl91cGRhdGVDYXJ0UHJpY2UgPSBmdW5jdGlvbigpIHtcclxuXHRcdHRoaXMuY2FydExpc3QucXVlcnlTZWxlY3RvcihcIi50b3RhbC1wcmljZVwiKS5pbm5lckhUTUwgPSB0aGlzLmNhbGNUb3RhbFByaWNlKHRoaXMuY3VycmVudFByb21vQ29kZSkgKyBcIiRcIjtcclxuXHR9O1xyXG5cclxuXHR0aGlzLl91cGRhdGVDYXJ0QnV0dG9uID0gZnVuY3Rpb24oY291bnRJdGVtcykge1xyXG5cdFx0aWYoY291bnRJdGVtcz4wICYmICEkRCh0aGlzLmJ0blNob3BwaW5nQ2FydENvbnRhaW5lcikuaGFzQ2xhc3MoJ2FjdGl2ZScpKSB7XHJcblx0XHRcdCREKHRoaXMuYnRuU2hvcHBpbmdDYXJ0Q29udGFpbmVyKS5hZGRDbGFzcyhcImFjdGl2ZVwiKTtcclxuXHRcdH1cclxuXHRcdGVsc2UgaWYgKGNvdW50SXRlbXMgPT09IDApIHtcclxuXHRcdFx0JEQodGhpcy5idG5TaG9wcGluZ0NhcnRDb250YWluZXIpLnJlbW92ZUNsYXNzKFwiYWN0aXZlXCIpO1xyXG5cdFx0fVxyXG5cclxuXHRcdHRoaXMuY2FydENvdW50LmlubmVySFRNTCA9IFwiKFwiK2NvdW50SXRlbXMrXCIpXCI7XHRcclxuXHJcblx0XHRcclxuXHR9O1xyXG5cclxuXHJcblx0dGhpcy5fdXBkYXRlUHJvbW9Db2RlRG9tID0gZnVuY3Rpb24ocHJvbW9JbnB1dCkge1xyXG5cdFx0XHR0aGlzLmFwcGx5UHJvbW9Db2RlKHByb21vSW5wdXQudmFsdWUpO1xyXG5cdFx0XHRcclxuXHRcdFx0aWYocHJvbW9JbnB1dC52YWx1ZS50b1VwcGVyQ2FzZSgpID09PSB0aGlzLmN1cnJlbnRQcm9tb0NvZGUpIHtcclxuXHRcdFx0XHQkRChwcm9tb0lucHV0KS5hZGRDbGFzcyhcImFjdGl2ZVwiKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHQkRChwcm9tb0lucHV0KS5yZW1vdmVDbGFzcyhcImFjdGl2ZVwiKTtcclxuXHRcdFx0fVxyXG5cdFx0XHJcblx0fTtcdFx0XHJcblxyXG5cdHRoaXMuYXBwbHlQcm9tb0NvZGUgPSBmdW5jdGlvbiAocHJvbW9Db2RlKSB7XHJcblx0XHRwcm9tb0NvZGUgPSBwcm9tb0NvZGUudG9VcHBlckNhc2UoKTtcclxuXHRcdHZhciBjdXJyZW50VmFsdWUgPSAodGhpcy5jdXJyZW50UHJvbW9Db2RlKT8gdGhpcy5jYWxjVG90YWxQcmljZSh0aGlzLmN1cnJlbnRQcm9tb0NvZGUpIDogdGhpcy5jYWxjVG90YWxQcmljZSgpIDtcclxuXHRcdHZhciBwcm9tb1ZhbHVlID0gMDtcclxuXHJcblx0XHRwcm9tb1ZhbHVlID0gdGhpcy5jYWxjVG90YWxQcmljZShwcm9tb0NvZGUpO1xyXG5cclxuXHRcdGlmKHByb21vVmFsdWUgPCBjdXJyZW50VmFsdWUgKSB7XHJcblx0XHRcdHRoaXMuY3VycmVudFByb21vQ29kZSA9IHByb21vQ29kZTtcclxuXHRcdH1cclxuXHJcblx0XHR0aGlzLnVwZGF0ZURvbSgpO1xyXG5cdH07XHJcblxyXG5cdHRoaXMuY2FsY1RvdGFsUHJpY2UgPSBmdW5jdGlvbihwcm9tb0NvZGUpIHtcclxuXHRcdHZhciB0b3RhbCA9IDA7XHJcblx0XHR2YXIgcHJvbW9GdW5jdGlvbjtcclxuXHRcdHZhciBzZWxmID0gdGhpcztcclxuXHJcblx0XHRpZihwcm9tb0NvZGUpIHtcclxuXHRcdFx0cHJvbW9GdW5jdGlvbiA9IHRoaXMuZ2V0UHJvbW9GdW5jKHByb21vQ29kZSk7XHRcclxuXHRcdH1cclxuXHRcdFxyXG5cdFx0dGhpcy5fZ2V0Q2FydEl0ZW1zKCkuZm9yRWFjaChmdW5jdGlvbihpdGVtKXtcclxuXHRcdFx0dmFyIHF1YW50aXR5ID0gcGFyc2VJbnQoaXRlbS5xdWVyeVNlbGVjdG9yKCcucHJvZHVjdF9fcXVhbnRpdHkgPiBpbnB1dCcpLnZhbHVlKTtcclxuXHRcdFx0dmFyIHByaWNlID0gc2VsZi5nZXRQcm9kdWN0UHJpY2UoaXRlbSk7XHJcblx0XHRcdFxyXG5cdFx0XHRpZiggcHJvbW9GdW5jdGlvbiAhPT0gdW5kZWZpbmVkICkge1xyXG5cdFx0XHRcdHByaWNlID0gcHJvbW9GdW5jdGlvbihpdGVtKTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0dG90YWwgKz0gKHF1YW50aXR5ICogcHJpY2UpO1xyXG5cdFx0fSk7XHJcblxyXG5cdFx0cmV0dXJuIHRvdGFsLnRvRml4ZWQoMik7XHJcblx0fTtcclxuXHJcblx0dGhpcy5fZ2V0Q2FydEl0ZW1zID0gZnVuY3Rpb24oKSB7XHJcblx0XHRyZXR1cm4gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmNhcnQtbGlzdC1jb250YWluZXIgYXJ0aWNsZS5wcm9kdWN0Om5vdCgjZHVtbXkpJyk7XHJcblx0fVxyXG5cclxuXHJcblx0dGhpcy5pbml0ID0gZnVuY3Rpb24oKSB7XHJcblx0XHR0aGlzLl9yZWdpc3RlckFkZFRvQ2FydEV2ZW50KCk7XHJcblx0XHR0aGlzLl9yZWdpc3RlclByb21vQ29kZUV2ZW50KCk7XHJcblxyXG5cdFx0cmV0dXJuIHRoaXM7XHJcblx0fTtcclxuXHJcblx0dGhpcy5fcmVnaXN0ZXJBZGRUb0NhcnRFdmVudCA9IGZ1bmN0aW9uKCkge1xyXG5cdFx0ZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnByb2R1Y3QtbGlzdCA+IC5wcm9kdWN0JykuZm9yRWFjaChmdW5jdGlvbihwcm9kdWN0KXtcclxuXHRcdFx0XHJcblx0XHRcdHZhciBwcm9kdWN0RGF0YSA9IHtcclxuXHRcdFx0XHRpZDpwcm9kdWN0LmdldEF0dHJpYnV0ZSgnZGF0YS1wcm9kdWN0LWlkJyksXHJcblx0XHRcdFx0bmFtZTogcHJvZHVjdC5xdWVyeVNlbGVjdG9yKCcucHJvZHVjdF9fdGl0bGUnKS5pbm5lckhUTUwsXHJcblx0XHRcdFx0ZGVzY3JpcHRpb246IHByb2R1Y3QucXVlcnlTZWxlY3RvcignLnByb2R1Y3RfX2Rlc2NyaXB0aW9uJykuaW5uZXJIVE1MLFxyXG5cdFx0XHRcdHByaWNlOiBwcm9kdWN0LnF1ZXJ5U2VsZWN0b3IoJy5wcm9kdWN0X19wcmljZScpLmlubmVySFRNTCxcclxuXHRcdFx0XHRpbWdVcmw6IHByb2R1Y3QucXVlcnlTZWxlY3RvcignLnByb2R1Y3RfX2ltYWdlJykuc3R5bGUuYmFja2dyb3VuZEltYWdlXHJcblx0XHRcdH07XHJcblx0XHRcdFxyXG5cdFx0XHRwcm9kdWN0LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oZSl7XHJcblx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cdFx0XHRcdGNhcnQuYWRkSXRlbShwcm9kdWN0RGF0YSk7XHJcblx0XHRcdH0pO1xyXG5cdFx0fSk7XHRcdFxyXG5cdH07XHJcblxyXG5cdHRoaXMuX3JlZ2lzdGVyUHJvbW9Db2RlRXZlbnQgPSBmdW5jdGlvbigpIHtcclxuXHRcdHZhciBzZWxmID0gdGhpcztcclxuXHRcdGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicHJvbW9Db2RlXCIpLmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLGZ1bmN0aW9uKCl7XHJcblx0XHRcdHNlbGYuX3VwZGF0ZVByb21vQ29kZURvbSh0aGlzKTtcclxuXHRcdH0pO1xyXG5cdH07XHJcblxyXG59O1xyXG5cclxuZnVuY3Rpb24gRG9tVXRpbHMoZWxlbWVudCkge1xyXG5cdHRoaXMuZWwgPSBlbGVtZW50O1xyXG5cclxuXHR0aGlzLmdldEVsID0gZnVuY3Rpb24oKSB7XHJcblx0XHRyZXR1cm4gdGhpcy5lbDtcclxuXHR9XHJcbiAgICB0aGlzLmhhc0NsYXNzID0gZnVuY3Rpb24oY2xzKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZWwuY2xhc3NOYW1lLmluZGV4T2YoY2xzKSA+IC0xO1xyXG4gICAgfTtcclxuXHJcblx0dGhpcy5hZGRDbGFzcyA9IGZ1bmN0aW9uKGFkZCkge1xyXG5cdFx0aWYodGhpcy5oYXNDbGFzcyhcIiBcIithZGQrXCIgXCIpKSByZXR1cm4gdGhpcztcclxuXHJcblx0XHR0aGlzLmVsLmNsYXNzTmFtZSArPSBcIiBcIisgYWRkK1wiIFwiO1xyXG5cdFx0cmV0dXJuIHRoaXM7XHJcblx0fTtcclxuXHJcblx0dGhpcy5yZW1vdmVDbGFzcyA9IGZ1bmN0aW9uKHJlbW92ZSkge1xyXG5cdFx0aWYoIXRoaXMuaGFzQ2xhc3MocmVtb3ZlKSkgcmV0dXJuIHRoaXM7XHJcblx0ICAgIFxyXG5cdCAgICB2YXIgbmV3Q2xhc3NOYW1lID0gXCJcIjtcclxuXHQgICAgdmFyIGk7XHJcblx0ICAgIHZhciBjbGFzc2VzID0gdGhpcy5lbC5jbGFzc05hbWUuc3BsaXQoXCIgXCIpLmZpbHRlcihmdW5jdGlvbihjbHNOYW1lKXtyZXR1cm4gY2xzTmFtZTt9KTtcclxuXHJcblx0ICAgIGZvcihpID0gMDsgaSA8IGNsYXNzZXMubGVuZ3RoOyBpKyspIHtcclxuXHQgICAgICAgIGlmKGNsYXNzZXNbaV0gIT09IHJlbW92ZSkge1xyXG5cdCAgICAgICAgICAgIG5ld0NsYXNzTmFtZSArPSBjbGFzc2VzW2ldICsgXCIgXCI7XHJcblx0ICAgICAgICB9XHJcblx0ICAgIH1cclxuXHQgICAgXHJcblx0ICAgIHRoaXMuZWwuY2xhc3NOYW1lID0gbmV3Q2xhc3NOYW1lO1xyXG5cclxuXHQgICAgcmV0dXJuIHRoaXM7XHJcblx0fTtcclxuXHJcblx0dGhpcy5jYWxsYmFja0FuaW0gPSBmdW5jdGlvbihhbmltQ2xhc3MsbWlsbGlzZWNvbmRzLGNiRnVuYykge1xyXG5cdFx0dGhpcy5hZGRDbGFzcyhhbmltQ2xhc3MpO1xyXG5cdFx0dmFyIHNlbGYgPSB0aGlzO1xyXG5cdFx0dmFyIGNiID0gZnVuY3Rpb24oKSB7XHJcblx0XHRcdHNlbGYucmVtb3ZlQ2xhc3MoYW5pbUNsYXNzKTtcclxuXHRcdFx0XHJcblx0XHRcdGlmKGNiRnVuYykge1xyXG5cdFx0XHRcdGNiRnVuYy5iaW5kKHNlbGYpKCk7XHRcclxuXHRcdFx0fVxyXG5cdFx0fTtcclxuXHJcblx0XHRzZXRUaW1lb3V0KGNiLCBtaWxsaXNlY29uZHMpO1xyXG5cdH07XHRcclxuXHJcblx0cmV0dXJuIHRoaXM7XHJcbn07XHJcblxyXG4kRCA9IGZ1bmN0aW9uKGVsZW1lbnQpIHtcclxuXHR2YXIgZEVsID0gbmV3IERvbVV0aWxzKGVsZW1lbnQpO1xyXG5cdHJldHVybiBkRWw7XHJcbn1cclxuXHJcblxyXG52YXIgY2FydCA9IG5ldyBTaG9wcGluZ0NhcnQoKS5pbml0KCk7XHJcblxyXG5cclxuXHJcblxyXG4iXX0=
